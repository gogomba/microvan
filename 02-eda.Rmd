# Explorative Data Analysis
***
```{r, message=FALSE, warning=FALSE}
# multivariate analysis and basic descriptive statistics
library(psych)  

# data processing
library(dplyr)
library(tidyverse)
library(data.table)
library(DT)


# plot
library(ggplot2)
library(corrplot)
library(ggthemes)

# rMarkdown 
library(rmarkdown)
library(kableExtra)

# file path management 
library(here)

# stat
library(factoextra)
```

```{r, include=FALSE}
# set working directory 
# file path
mainDir = here::here("~/Documents/github/MBA/Application/ESMT/Course/Module2/Customer_Analytics/CA6/GroupCapstone/Microvan")
dataDir = file.path(mainDir,"data")
plotDir = file.path(mainDir,"plot")
reportDir = file.path(mainDir, "report")
```

```{r}
# data 
dataPath = file.path(dataDir, "microvan.csv")
microvan = read.csv(dataPath, sep=";")

# Convert all integer variables into numeric ones for futher work
microvan <- as.data.table(lapply(microvan, as.numeric))

# data description
description = psych::describe(microvan) %>%
  as.data.frame()
description 


```

## Histogram
```{r echo=FALSE, message=FALSE}

microvan_df = microvan[,2:32] %>%
  gather()

microvan_hist =
  ggplot(microvan_df, aes(value)) +
  facet_wrap(~ key, scales = "free",ncol = 6) +
   geom_histogram(alpha = 0.5, position = "identity")  + theme_economist_white() +theme(axis.title.x = element_blank())

microvan_hist_path = file.path(plotDir, "microvan_hist.png")
ggsave(
  filename =microvan_hist_path,
  plot = microvan_hist,
  width = 4000,
  height =4000,
  units = "px"
)
```

```{r echo=FALSE, fig.cap="", out.width = '100%'}
knitr::include_graphics(microvan_hist_path)
```

## Correlation Analysis
### Pair-wise Scatter Plot
```{r,echo=FALSE,message=FALSE}
# scale data
vars <- scale(microvan[,2:32])


# plot name
scatterPlot = file.path(plotDir, "scatter_plot.png")

# save to an png
png(
  filename = scatterPlot ,
  width = 800,
  height = 800
)
# plot first 10 varaibles
pairs.panels(vars[,1:10], scale =TRUE,show.points = FALSE,cex.cor = 2.5,
             method = "pearson", # correlation method
             hist.col = "#00AFBB",
             density = TRUE  # show density plots
             #ellipses = TRUE, # show correlation ellipses
             )
invisible(dev.off())
```

```{r echo=FALSE, fig.cap="", out.width = '100%'}
knitr::include_graphics(scatterPlot)
```

### Correlation Matrix
```{r,echo=FALSE,message=FALSE}
# plot name
corrPlot = file.path(plotDir, "corrPlot.png")
cor_with_mvliking <- cor(vars[,-1])
png(
  filename = corrPlot,
  width = 1500,
  height = 1500
)

corrplot(cor_with_mvliking, 
         method="number", 
         type="upper", 
         order = "hclust", # reorder by the size of the correlation coefficients
         tl.cex = 1.4,     # font size of the variable labels
         tl.col = "black", # color of the variable labels
         tl.srt = 45,      # rotation angle for the variable labels
         number.cex = 1.4    # font size of the coefficients
)
invisible(dev.off())

```

```{r  echo=FALSE, fig.cap="", out.width = '100%'}
knitr::include_graphics(corrPlot )
```



