# Data verification
***
```{r, message=FALSE, warning=FALSE}
# multivariate analysis and basic descriptive statistics
library(psych)  

# data processing
library(dplyr)
library(tidyverse)
library(data.table)

# plot
library(ggplot2)
library(corrplot)

# rMarkdown 
library(rmarkdown)


# file path management 
library(here)

```

```{r, include=FALSE}
# set working directory 
# Path
mainDir = here::here()
dataDir = file.path(mainDir,"data")
plotDir = file.path(mainDir,"plot")
reportDir = file.path(mainDir, "report")
```

```{r}
# Show it:
dataPath = file.path(dataDir, "microvan.csv")
microvan = read.csv(dataPath, sep=";")

# Convert all integer variables into numeric ones for futher work
microvan <- as.data.table(lapply(microvan, as.numeric))

# data description
description = psych::describe(microvan)
description 
```

# Explorative Data Analysis
## Correlation Analysis
***
### Pair-wise Scatter Plot
***
```{r,echo=FALSE,message=FALSE}
# plot name
scatterPlot = file.path(plotDir, "scatter_plot.png")

# save to an png
png(
  filename = scatterPlot ,
  width = 800,
  height = 800
)
# plot
pairs.panels(microvan[,2:11], scale =TRUE,show.points = FALSE,cex.cor = 2.5,
             method = "pearson", # correlation method
             hist.col = "#00AFBB",
             density = TRUE  # show density plots
             #ellipses = TRUE, # show correlation ellipses
             )
invisible(dev.off())
```

```{r echo=FALSE, fig.cap="", out.width = '100%'}
knitr::include_graphics(scatterPlot)
```

### Correlation Matrix
```{r,echo=FALSE,message=FALSE}
# plot name
corrPlot = file.path(plotDir, "corrPlot.png")
cor <- cor(microvan[,2:32])
png(
  filename = corrPlot,
  width = 1200,
  height = 1200
)

corrplot(cor, 
         method="number", 
         type="upper", 
         order = "hclust", # reorder by the size of the correlation coefficients
         tl.cex = 1,     # font size of the variable labels
         tl.col = "black", # color of the variable labels
         tl.srt = 45,      # rotation angle for the variable labels
         number.cex = 1    # font size of the coefficients
)
invisible(dev.off())

```

```{r  echo=FALSE, fig.cap="", out.width = '100%'}
knitr::include_graphics(corrPlot )
```



## Eigenvalues
```{r}
EV = eigen(cor)$values
EV
```

### Scree Plot
```{r}
scree(cor, pc = TRUE, factors = FALSE)

```

### Cumulative Percentages of Variance 
```{r}
# Shares for the cumulative variance explained
plot(cumsum(EV/length(EV)), 
     type = "o", # type of plot: "o" for points and lines 'overplotted'
     col = "darkblue",
     pch = 16, # plot symbol: 16 = filled circle
     cex = 1, # size of plot symbols
     xlab = "Number of factors", # a title for the x axis
     ylab = "Cumulative variance explained", # a title for the y axis
     lwd = 2) # line width
abline(v = 5, lwd = 2, col = "grey") # draw a vertical line at v = 3
```

